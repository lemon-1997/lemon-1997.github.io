window.NexT={},NexT.boot={},NexT.plugins={},NexT.plugins.comments={},NexT.plugins.comments.register=function(){if(!NexT.CONFIG.page.comments)return;for(var a in NexT.plugins.comments){if(a==='register')continue;eval('NexT.plugins.comments.'+a)()}},NexT.plugins.search={},NexT.plugins.search.register=function(){for(var a in NexT.plugins.search){if(a==='register')continue;eval('NexT.plugins.search.'+a)()}},NexT.plugins.share={},NexT.plugins.share.register=function(){for(var a in NexT.plugins.share){if(a==='register')continue;eval('NexT.plugins.share.'+a)()}},NexT.plugins.others={},NexT.plugins.others.register=function(){for(var a in NexT.plugins.others){if(a==='register')continue;eval('NexT.plugins.others.'+a)()}},NexT.plugins.register=function(){for(var a in NexT.plugins){if(a==='register')continue;eval('NexT.plugins.'+a+'.register')()}},function(){const d='next-config',a={};let b={};const e=a=>JSON.parse(a||'{}'),c=c=>{const f=document.querySelector(`.${d}[data-name="${c}"]`);if(!f)return;const g=e(f.text);c==='main'?Object.assign(a,g):b[c]=g};c('main'),window.NexT.CONFIG=new Proxy({},{get(f,d){let e;if(d in a?e=a[d]:(d in b||c(d),e=b[d]),!(d in f)&&typeof e=='object'&&(f[d]={}),d in f){const a=f[d];return typeof a=='object'&&typeof e=='object'?new Proxy({...e,...a},{set(d,b,c){return d[b]=c,a[b]=c,!0}}):a}return e}})}(),HTMLElement.prototype.wrap=function(a){this.parentNode.insertBefore(a,this),this.parentNode.removeChild(this),a.appendChild(this)},NexT.utils={registerImageLoadEvent:function(){const a=document.querySelectorAll('.sidebar img, .post-block img, .vendors-list img'),b=a=>{a.forEach(a=>{if(a.intersectionRatio>0){let b=a.target,c=b.getAttribute('data-src');if(c){let a=new Image;a.addEventListener('load',function(){b.src=c},!1),b.src=c,b.removeAttribute('data-src')}}})},c=new IntersectionObserver(b);a.forEach(a=>{c.observe(a)})},registerImageViewer:function(){new Viewer(document.querySelector('.post-body'),{navbar:2,toolbar:2})},registerToolButtons:function(){const a=document.querySelector('.tool-buttons'),b=a.querySelectorAll('div:not(#toggle-theme)');b.forEach(b=>{let a=b.id;a!=''&&(a=a.substring(5)),b.addEventListener('click',()=>{this.slidScrollBarAnime(a)})}),a.querySelector('div#toggle-theme').addEventListener('click',()=>{const a=document.documentElement.getAttribute('data-theme');window.theme.toggle(a==='dark'?'light':'dark')})},slidScrollBarAnime:function(a,b='linear',c=500){window.anime({targets:document.scrollingElement,duration:c,easing:b,scrollTop:a==''?0:document.getElementById(a).getBoundingClientRect().top+window.scrollY})},domAddClass:function(b,c){const a=document.querySelectorAll(b);a&&a.forEach(a=>{a.classList.add(c)})},fmtSiteInfo:function(){const a=document.getElementById('runTimes');if(a){const b=a.getAttribute('data-publishDate'),c=this.diffDate(b,2);a.innerText=c}const b=document.getElementById('wordsCount');if(b){const a=b.getAttribute('data-count');b.innerText=this.numberFormat(a)}const c=document.getElementById('readTimes');if(c){const a=c.getAttribute('data-times'),b=60,g=b*24,e=parseInt(a/g),f=parseInt(a/b);let d;e>=1?d=e+NexT.CONFIG.i18n.ds_days+parseInt((a-e*g)/b)+NexT.CONFIG.i18n.ds_hours:f>=1?d=f+NexT.CONFIG.i18n.ds_hours+(a-f*b)+NexT.CONFIG.i18n.ds_mins:d=a+NexT.CONFIG.i18n.ds_mins,c.innerText=d}const d=document.getElementById('last-push-date');if(d){const a=this.diffDate(d.getAttribute('data-lastPushDate'),1);d.innerText=a}},fmtLaWidget:function(){setTimeout(function(){const a=document.querySelectorAll('#la-siteinfo-widget span');if(a.length>0){const b=[0,2,4,6],c=['today_site_pv','yesterday_site_pv','month_site_pv','total_site_pv'];for(let d in b){let e=NexT.utils.numberFormat(a[b[d]].innerText);document.getElementById(c[d]).innerText=e}}},800)},fmtBusuanzi:function(){setTimeout(function(){const a=document.getElementById('busuanzi_value_site_uv');a&&(a.innerText=NexT.utils.numberFormat(a.innerText));const b=document.getElementById('busuanzi_value_site_pv');b&&(b.innerText=NexT.utils.numberFormat(b.innerText))},800)},numberFormat:function(a){let b;return a.indexOf(',')>0&&(a=a.replaceAll(",","")),a>1e4?b=(a/1e4).toFixed(2)+' w':a>1e3?b=(a/1e3).toFixed(2)+' k':b=a,b},diffDate:function(j,h=0){const k=new Date,f=new Date(j),b=k.getTime()-f.getTime(),g=1e3*60,d=g*60,c=d*24,e=c*30,i=e*12;let a;if(h==1){const h=b/e,i=b/c,j=b/d,k=b/g;h>12?a=f.toLocaleDateString().replace(/\//g,'-'):h>=1?a=parseInt(h)+NexT.CONFIG.i18n.ds_month:i>=1?a=parseInt(i)+NexT.CONFIG.i18n.ds_day:j>=1?a=parseInt(j)+NexT.CONFIG.i18n.ds_hour:k>=1?a=parseInt(k)+NexT.CONFIG.i18n.ds_min:a=NexT.CONFIG.i18n.ds_just}else if(h==2){const d=parseInt(b/i);if(d>=1){const e=parseInt((b-d*i)/c);a=d+NexT.CONFIG.i18n.ds_years+e+NexT.CONFIG.i18n.ds_days}else{const d=parseInt(b/c);a=d+NexT.CONFIG.i18n.ds_days}}else a=parseInt(b/c);return a},checkDOMExist:function(a){return document.querySelector(a)!=null},getCDNResource:function(h){let{plugins:j,router:c}=NexT.CONFIG.vendor,{name:g,version:d,file:e,alias:i,alias_name:b}=h,f=g;b&&(f=b);let a='';switch(j){case'cdnjs':case'bootcdn':case'qiniu':let h=i||g,b=e.replace(/^(dist|lib|source|\/js|)\/(browser\/|)/,'');b.indexOf('min')==-1&&(b=b.replace(/\.js$/,'.min.js')),a=`${c}/${h}/${d}/${b}`;break;default:a=`${c}/${f}@${d}/${e}`}return a},registerCopyCode:function(){if(!NexT.CONFIG.copybtn)return;let a=document.querySelectorAll('.highlight pre');if(a.length===0||!NexT.CONFIG.copybtn)return;a.forEach(a=>{let c=a.querySelector('code').className;if(c=='')return;a.insertAdjacentHTML('beforeend','<div class="copy-btn"><i class="fa fa-copy fa-fw"></i></div>');const b=a.querySelector('.copy-btn');b.addEventListener('click',()=>{const d=a.querySelector('.code')||a.querySelector('code'),c=d.innerText;if(navigator.clipboard)navigator.clipboard.writeText(c).then(()=>{b.querySelector('i').className='fa fa-check-circle fa-fw'},()=>{b.querySelector('i').className='fa fa-times-circle fa-fw'});else{const a=document.createElement('textarea');a.style.top=window.scrollY+'px',a.style.position='absolute',a.style.opacity='0',a.readOnly=!0,a.value=c,document.body.append(a),a.select(),a.setSelectionRange(0,c.length),a.readOnly=!1;const d=document.execCommand('copy');b.querySelector('i').className=d?'fa fa-check-circle fa-fw':'fa fa-times-circle fa-fw',a.blur(),b.blur(),document.body.removeChild(a)}}),a.addEventListener('mouseleave',()=>{setTimeout(()=>{b.querySelector('i').className='fa fa-copy fa-fw'},300)})})},wrapTableWithBox:function(){document.querySelectorAll('table').forEach(b=>{const a=document.createElement('div');a.className='table-container',b.wrap(a)})},registerVideoIframe:function(){document.querySelectorAll('iframe').forEach(a=>{const b=['www.youtube.com','player.vimeo.com','player.youku.com','player.bilibili.com','www.tudou.com'].some(b=>a.src.includes(b));if(b&&!a.parentNode.matches('.video-container')){const b=document.createElement('div');b.className='video-container',a.wrap(b);const c=Number(a.width),d=Number(a.height);c&&d&&(b.style.paddingTop=d/c*100+'%')}})},registerScrollPercent:function(){const a=document.querySelector('.back-to-top'),b=document.querySelector('.reading-progress-bar');window.addEventListener('scroll',()=>{if(a||b){const c=document.body.scrollHeight-window.innerHeight,d=c>0?Math.min(100*window.scrollY/c,100):0;if(a){const b=Math.round(d),c=b>=5;a.classList.toggle('back-to-top-on',c),a.querySelector('span').innerText=b+'%'}b&&b.style.setProperty('--progress',d.toFixed(2)+'%')}if(!Array.isArray(NexT.utils.sections))return;let c=NexT.utils.sections.findIndex(a=>a&&a.getBoundingClientRect().top>10);c===-1?c=NexT.utils.sections.length-1:c>0&&c--,this.activateNavByIndex(c)},{passive:!0})},registerTabsTag:function(){document.querySelectorAll('.tabs ul.nav-tabs .tab').forEach(a=>{a.addEventListener('click',d=>{if(d.preventDefault(),a.classList.contains('active'))return;const c=a.parentNode;[...c.children].forEach(b=>{b.classList.toggle('active',b===a)});const b=document.getElementById(a.querySelector('a').getAttribute('href').replace('#',''));if([...b.parentNode.children].forEach(a=>{a.classList.toggle('active',a===b)}),b.dispatchEvent(new Event('tabs:click',{bubbles:!0})),!NexT.CONFIG.stickytabs)return;const e=c.parentNode.getBoundingClientRect().top+window.scrollY+10;window.anime({targets:document.scrollingElement,duration:500,easing:'linear',scrollTop:e})})}),window.dispatchEvent(new Event('tabs:register'))},registerCanIUseTag:function(){window.addEventListener('message',({data:a})=>{if(typeof a=='string'&&a.includes('ciu_embed')){const b=a.split(':')[1],c=a.split(':')[2];document.querySelector(`iframe[data-feature=${b}]`).style.height=parseInt(c,10)+5+'px'}},!1)},registerSidebarTOC:function(){const a=document.getElementById('TableOfContents');if(!a.hasChildNodes()){const a=document.querySelector('.sidebar-inner');a.classList.remove('sidebar-nav-active','sidebar-toc-active'),a.classList.add('sidebar-overview-active')}this.sections=[...document.querySelectorAll('.post-toc li a')].map(a=>{const b=document.getElementById(decodeURI(a.getAttribute('href')).replace('#',''));return a.addEventListener('click',c=>{c.preventDefault();const d=b.getBoundingClientRect().top+window.scrollY;window.anime({targets:document.scrollingElement,duration:500,easing:'linear',scrollTop:d,complete:()=>{history.pushState(null,document.title,a.href)}})}),b})},registerPostReward:function(){const a=document.querySelector('.reward-container button');if(!a)return;a.addEventListener('click',()=>{document.querySelector('.post-reward').classList.toggle('active')})},initCommontesDispaly:function(){const a=document.querySelectorAll('.comment-wrap > div');if(a.length<=1)return;a.forEach(function(a){let b=window.getComputedStyle(a,null).display;a.style.display=b})},registerCommonSwitch:function(){const a=document.querySelector('.comment-switch .switch-btn');if(!a)return;const b=document.querySelectorAll('.comment-wrap > div');a.addEventListener('click',()=>{a.classList.toggle('move'),b.forEach(function(a){a.style.display==='none'?a.style.cssText="display: block; animation: tabshow .8s":a.style.cssText="display: none;"})})},hideCommontes:function(){document.querySelector('.post-comments').style.display='none'},hiddeLodingCmp:function(a){const b=document.querySelector(a).previousElementSibling;b.style.display='none'},activateNavByIndex:function(d){const a=document.querySelectorAll('.post-toc li a')[d];if(!a||a.classList.contains('active-current'))return;document.querySelectorAll('.post-toc .active').forEach(a=>{a.classList.remove('active','active-current')}),a.classList.add('active','active-current');let b=a.parentNode;while(!b.matches('.post-toc'))b.matches('li')&&b.classList.add('active'),b=b.parentNode;const c=document.querySelector('.sidebar-panel-container');if(!c.parentNode.classList.contains('sidebar-toc-active'))return;window.anime({targets:c,duration:200,easing:'linear',scrollTop:c.scrollTop-c.offsetHeight/2+a.getBoundingClientRect().top-c.getBoundingClientRect().top})},updateSidebarPosition:function(){if(window.innerWidth<992||NexT.CONFIG.scheme==='Pisces'||NexT.CONFIG.scheme==='Gemini')return;const b=document.querySelector('.post-toc');let a=NexT.CONFIG.sidebar;typeof a!='boolean'&&(a=NexT.CONFIG.sidebar.display==='always'||NexT.CONFIG.sidebar.display==='post'&&b),a&&window.dispatchEvent(new Event('sidebar:show'))},activateSidebarPanel:function(a){const c=200,d=document.querySelector('.sidebar-inner'),e=document.querySelector('.sidebar-panel-container'),b=['sidebar-toc-active','sidebar-overview-active'];if(d.classList.contains(b[a]))return;window.anime({duration:c,targets:e,easing:'linear',opacity:0,translateY:[0,-20],complete:()=>{d.classList.replace(b[1-a],b[a]),window.anime({duration:c,targets:e,easing:'linear',opacity:[0,1],translateY:[-20,0]})}})},getStyle:function(c,d='after',e){const a=document.createElement('link');a.setAttribute('rel','stylesheet'),a.setAttribute('type','text/css'),a.setAttribute('href',c);const b=e||document.head;d==='before'?b.prepend(a):b.append(a)},getScript:function(a,b={},e){if(typeof b=='function')return this.getScript(a,{condition:e}).then(b);const{condition:f=!1,attributes:{id:c='',async:g=!1,defer:h=!1,crossOrigin:d='',dataset:i={},...j}={},parentNode:k=null}=b;return new Promise((b,e)=>{if(f)b();else{const f=document.createElement('script');if(c&&(f.id=c),d&&(f.crossOrigin=d),f.async=g,f.defer=h,Object.assign(f.dataset,i),Object.entries(j).forEach(([a,b])=>{f.setAttribute(a,String(b))}),f.onload=b,f.onerror=e,typeof a=='object'){const{url:c,integrity:b}=a;f.src=c,b&&(f.integrity=b,f.crossOrigin='anonymous')}else f.src=a;(k||document.head).appendChild(f)}})},lazyLoadComponent:function(a,b){return b?this.lazyLoadComponent(a).then(b):new Promise(b=>{const c=document.querySelector(a);if(!c){b();return}const d=new IntersectionObserver((a,c)=>{const d=a[0];if(!d.isIntersecting)return;b(),c.disconnect()});d.observe(c)})}},function(){const a=()=>document.dispatchEvent(new Event('page:loaded',{bubbles:!0}));document.readyState==='loading'?document.addEventListener('readystatechange',a,{once:!0}):a(),document.addEventListener('pjax:success',a)}(),NexT.boot.registerEvents=function(){NexT.utils.registerImageLoadEvent(),NexT.utils.registerScrollPercent(),NexT.utils.registerToolButtons(),NexT.plugins.register(),document.querySelector('.site-nav-toggle .toggle').addEventListener('click',b=>{b.currentTarget.classList.toggle('toggle-close');const a=document.querySelector('.site-nav');if(!a)return;a.style.setProperty('--scroll-height',a.scrollHeight+'px'),document.body.classList.toggle('site-nav-on')}),document.querySelectorAll('.sidebar-nav li').forEach((a,b)=>{a.addEventListener('click',()=>{NexT.utils.activateSidebarPanel(b)})}),window.addEventListener('hashchange',()=>{const a=location.hash;if(a!==''&&!a.match(/%\S{2}/)){const b=document.querySelector(`.tabs ul.nav-tabs li a[href="${a}"]`);b&&b.click()}})},NexT.boot.refresh=function(){if(NexT.utils.fmtSiteInfo(),!NexT.CONFIG.page.isPage)return;NexT.utils.registerSidebarTOC(),NexT.utils.registerCopyCode(),NexT.utils.registerPostReward(),NexT.CONFIG.page.comments?(NexT.utils.initCommontesDispaly(),NexT.utils.registerCommonSwitch(),NexT.utils.domAddClass('#goto-comments','goto-comments-on')):NexT.utils.hideCommontes(),NexT.utils.registerImageViewer()},NexT.boot.motion=function(){NexT.CONFIG.motion.enable&&NexT.motion.integrator.add(NexT.motion.middleWares.header).add(NexT.motion.middleWares.postList).add(NexT.motion.middleWares.sidebar).add(NexT.motion.middleWares.footer).bootstrap(),NexT.utils.updateSidebarPosition()},document.addEventListener('DOMContentLoaded',()=>{NexT.boot.registerEvents(),NexT.boot.motion(),NexT.boot.refresh()}),NexT.motion={},NexT.motion.integrator={queue:[],init:function(){return this.queue=[],this},add:function(b){const a=b();return NexT.CONFIG.motion.async?this.queue.push(a):this.queue=this.queue.concat(a),this},bootstrap:function(){NexT.CONFIG.motion.async||(this.queue=[this.queue]),this.queue.forEach(b=>{const a=window.anime.timeline({duration:200,easing:'linear'});b.forEach(b=>{b.deltaT?a.add(b,b.deltaT):a.add(b)})})}},NexT.motion.middleWares={header:function(){const b=[];function c(a){b.push({targets:a,scaleX:[0,1],duration:500,deltaT:'-=200'})}function a(a,c=!1){b.push({targets:a,opacity:1,top:0,deltaT:c?'-=200':'-=0'})}return a('header.header'),NexT.CONFIG.scheme==='Mist'&&c('.logo-line'),NexT.CONFIG.scheme==='Muse'&&a('.custom-logo-image'),a('.site-title'),a('.site-brand-container .toggle',!0),a('.site-subtitle'),(NexT.CONFIG.scheme==='Pisces'||NexT.CONFIG.scheme==='Gemini')&&a('.custom-logo-image'),document.querySelectorAll('.menu-item').forEach(a=>{b.push({targets:a,complete:()=>a.classList.add('animated','fadeInDown'),deltaT:'-=200'})}),b},subMenu:function(){const a=document.querySelectorAll('.sub-menu .menu-item');return a.length>0&&a.forEach(a=>{a.classList.add('animated')}),[]},postList:function(){const b=[],{postblock:c,postheader:d,postbody:e,collheader:f}=NexT.CONFIG.motion.transition;function a(a,c){if(!a)return;document.querySelectorAll(c).forEach(c=>{b.push({targets:c,complete:()=>c.classList.add('animated',a),deltaT:'-=100'})})}return a(c,'.post-block,.flinks-block, .pagination, .post-comments'),a(f,'.collection-header'),a(d,'.post-header'),a(e,'.post-body'),b},sidebar:function(){const a=document.querySelector('.sidebar'),b=NexT.CONFIG.motion.transition.sidebar;return b&&(NexT.CONFIG.scheme==='Pisces'||NexT.CONFIG.scheme==='Gemini')?[{targets:a,complete:()=>a.classList.add('animated',b)}]:[]},footer:function(){return[{targets:document.querySelector('.footer'),opacity:1}]}},document.addEventListener('DOMContentLoaded',()=>{'use strict';const a=()=>{localStorage.setItem('bookmark'+location.pathname,window.scrollY)},b=()=>{let a=localStorage.getItem('bookmark'+location.pathname);a=parseInt(a,10),!isNaN(a)&&location.hash===''&&window.anime({targets:document.scrollingElement,duration:200,easing:'linear',scrollTop:a})},c=function(d){const c=document.querySelector('.book-mark-link');window.addEventListener('scroll',()=>c.classList.toggle('book-mark-link-fixed',window.scrollY===0),{passive:!0}),d==='auto'&&(window.addEventListener('beforeunload',a),document.addEventListener('pjax:send',a)),c.addEventListener('click',()=>{a(),window.anime({targets:c,duration:200,easing:'linear',top:-30,complete:()=>{setTimeout(()=>{c.style.top=''},400)}})}),b(),document.addEventListener('pjax:success',b)};c(NexT.CONFIG.bookmark.save)}),NexT.plugins.share.addthis=function(){const a='.addthis_inline_share_toolbox';if(!NexT.CONFIG.addthis||!NexT.utils.checkDOMExist(a))return;const b=NexT.CONFIG.addthis.js+'?pubid='+NexT.CONFIG.addthis.cfg.pubid;NexT.utils.lazyLoadComponent(a,function(){NexT.utils.getScript(b,{attributes:{async:!1},parentNode:document.querySelector(a)})})},NexT.plugins.comments.waline=function(){const a='.waline-container';if(!NexT.CONFIG.waline||!NexT.utils.checkDOMExist(a))return;const{comment:h,emoji:c,imguploader:d,pageview:e,placeholder:f,sofa:g,requiredmeta:o,serverurl:i,wordlimit:j,reaction:k,reactiontext:l,reactiontitle:m}=NexT.CONFIG.waline.cfg,n=NexT.utils.getCDNResource(NexT.CONFIG.waline.js);let b={placeholder:f,sofa:g,reactionTitle:m};l.forEach(function(a,c){b['reaction'+c]=a}),NexT.utils.lazyLoadComponent(a,function(){NexT.utils.getScript(n,function(){const f=NexT.utils.getCDNResource(NexT.CONFIG.waline.css);NexT.utils.getStyle(f,'before'),Waline.init({locale:b,el:a,pageview:e,comment:h,emoji:c,imageUploader:d,wordLimit:j,requiredMeta:o,reaction:k,serverURL:i,lang:NexT.CONFIG.lang,dark:'html[data-theme="dark"]'}),NexT.utils.hiddeLodingCmp(a)})})},NexT.plugins.others.counter=function(){let b=!1,c=void 0,d=void 0;const e=NexT.CONFIG.busuanzi;e!=void 0&&e.pageview&&(b=!0);const a=NexT.CONFIG.waline;a!=void 0&&(!b&&a.cfg.pageview&&(c=NexT.utils.getCDNResource(NexT.CONFIG.page.waline.js[0]),NexT.utils.getScript(c,function(){Waline.pageviewCount({serverURL:a.cfg.serverurl})})),a.cfg.comment&&(d=NexT.utils.getCDNResource(NexT.CONFIG.page.waline.js[1]),NexT.utils.getScript(d,function(){Waline.commentCount({serverURL:a.cfg.serverurl})})))},NexT.plugins.comments.giscus=function(){const a='.giscus-container';if(!NexT.CONFIG.page.comments||!NexT.CONFIG.giscus||!NexT.utils.checkDOMExist(a))return;const{category:b,categoryid:c,emit:d,inputposition:e,mapping:f,reactions:g,repo:h,repoid:i,theme:j}=NexT.CONFIG.giscus.cfg;NexT.utils.lazyLoadComponent(a,function(){NexT.utils.getScript(NexT.CONFIG.giscus.js,{attributes:{async:!0,crossorigin:'anonymous','data-repo':h,'data-repo-id':i,'data-category':b,'data-category-id':c,'data-mapping':f,'data-reactions-enabled':g?1:0,'data-emit-metadata':d?1:0,'data-input-position':e,'data-theme':j,'data-lang':NexT.CONFIG.lang,'data-loading':'lazy'},parentNode:document.querySelector(a)}),NexT.utils.hiddeLodingCmp(a)})},NexT.plugins.comments.utterances=function(){const a='.utterances-container';if(!NexT.CONFIG.utterances||!NexT.utils.checkDOMExist(a))return;const{repo:b,issueterm:c,label:d,theme:e}=NexT.CONFIG.utterances.cfg;NexT.utils.lazyLoadComponent(a,function(){NexT.utils.getScript(NexT.CONFIG.utterances.js,{attributes:{async:!0,crossorigin:'anonymous',repo:b,'issue-term':c,label:d,theme:e},parentNode:document.querySelector(a)}),NexT.utils.hiddeLodingCmp(a)})};class LocalSearch{constructor({path:a='',unescape:b=!1,top_n_per_article:c=1}){this.path=a,this.unescape=b,this.top_n_per_article=c,this.isfetched=!1,this.datas=null}getIndexByWord(e,a,c=!1){const b=[],d=new Set;return c||(a=a.toLowerCase()),e.forEach(e=>{if(this.unescape){const a=document.createElement('div');a.innerText=e,e=a.innerHTML}const g=e.length;if(g===0)return;let h=0,f=-1;for(c||(e=e.toLowerCase());(f=a.indexOf(e,h))>-1;)b.push({position:f,word:e}),d.add(e),h=f+g}),b.sort((a,b)=>a.position!==b.position?a.position-b.position:b.word.length-a.word.length),[b,d]}mergeIntoSlice(h,f,a){let d=a[0],{position:b,word:c}=d;const e=[],g=new Set;while(b+c.length<=f&&a.length!==0){g.add(c),e.push({position:b,length:c.length});const f=b+c.length;for(a.shift();a.length!==0;)if(d=a[0],b=d.position,c=d.word,f>b)a.shift();else break}return{hits:e,start:h,end:f,count:g.size}}highlightKeyword(b,c){let a='',d=c.start;for(const{position:e,length:f}of c.hits)a+=b.substring(d,e),d=e+f,a+=`<mark class="search-keyword">${b.substr(e,f)}</mark>`;return a+=b.substring(d,c.end),a}getResultItems(a){const b=[];return this.datas.forEach(({title:g,content:j,url:c})=>{const[h,n]=this.getIndexByWord(a,g),[f,o]=this.getIndexByWord(a,j),m=new Set([...n,...o]).size,l=h.length+f.length;if(l===0)return;const i=[];h.length!==0&&i.push(this.mergeIntoSlice(0,g.length,h));let d=[];while(f.length!==0){const b=f[0],{position:a}=b,c=Math.max(0,a-20),e=Math.min(j.length,a+80);d.push(this.mergeIntoSlice(c,e,f))}d.sort((a,b)=>a.count!==b.count?b.count-a.count:a.hits.length!==b.hits.length?b.hits.length-a.hits.length:a.start-b.start);const k=parseInt(this.top_n_per_article,10);k>=0&&(d=d.slice(0,k));let e='';c=new URL(c,location.origin),c.searchParams.append('highlight',a.join(' ')),i.length!==0?e+=`<li><a href="${c.href}" class="search-result-title">${this.highlightKeyword(g,i[0])}</a>`:e+=`<li><a href="${c.href}" class="search-result-title">${g}</a>`,d.forEach(a=>{e+=`<a href="${c.href}"><p class="search-result">${this.highlightKeyword(j,a)}...</p></a>`}),e+='</li>',b.push({item:e,id:b.length,hitCount:l,includedCount:m})}),b}fetchData(){const a=!this.path.endsWith('json');fetch(new URL(this.path,location.origin).href).then(a=>a.text()).then(b=>{this.isfetched=!0,this.datas=a?[...(new DOMParser).parseFromString(b,'text/xml').querySelectorAll('entry')].map(a=>({title:a.querySelector('title').textContent,content:a.querySelector('content').textContent,url:a.querySelector('url').textContent.replace('https://lemon-1997.github.io/','')})):JSON.parse(b),this.datas=this.datas.filter(a=>a.title).map(a=>(a.title=a.title.trim(),a.content=a.content?a.content.trim().replace(/<[^>]+>/g,''):'',a.url=decodeURIComponent(a.url).replace(/\/{2,}/g,'/'),a)),window.dispatchEvent(new Event('search:loaded'))})}highlightText(a,b,f){const c=a.nodeValue;let d=b.start;const e=[];for(const{position:a,length:h}of b.hits){const i=document.createTextNode(c.substring(d,a));d=a+h;const g=document.createElement('mark');g.className=f,g.appendChild(document.createTextNode(c.substr(a,h))),e.push(i,g)}a.nodeValue=c.substring(d,b.end),e.forEach(b=>{a.parentNode.insertBefore(b,a)})}highlightSearchWords(b){const c=new URL(location.href).searchParams.get('highlight'),d=c?c.split(' '):[];if(!d.length||!b)return;const a=document.createTreeWalker(b,NodeFilter.SHOW_TEXT,null),e=[];while(a.nextNode())a.currentNode.parentNode.matches('button, select, textarea')||e.push(a.currentNode);e.forEach(a=>{const[b]=this.getIndexByWord(d,a.nodeValue);if(!b.length)return;const c=this.mergeIntoSlice(0,a.nodeValue.length,b);this.highlightText(a,c,'search-keyword')})}}NexT.plugins.search.localsearch=function(){if(!NexT.CONFIG.localSearch.path){console.warn('`search indexes file` is not configurate!');return}const a=new LocalSearch({path:NexT.CONFIG.localSearch.path,top_n_per_article:NexT.CONFIG.localSearch.topnperarticle,unescape:NexT.CONFIG.localSearch.unescape}),b=document.querySelector('.search-input'),c=()=>{if(!a.isfetched)return;const f=b.value.trim().toLowerCase(),e=f.split(/[-\s]+/),c=document.querySelector('.search-result-container');let d=[];if(f.length>0&&(d=a.getResultItems(e)),e.length===1&&e[0]==='')c.classList.add('no-result'),c.innerHTML='<div class="search-result-icon"><i class="fa fa-search fa-5x"></i></div>';else if(d.length===0)c.classList.add('no-result'),c.innerHTML='<div class="search-result-icon"><i class="far fa-frown fa-5x"></i></div>';else{d.sort((a,b)=>a.includedCount!==b.includedCount?b.includedCount-a.includedCount:a.hitCount!==b.hitCount?b.hitCount-a.hitCount:b.id-a.id);const a=NexT.CONFIG.i18n.hits.replace('${hits}',d.length);c.classList.remove('no-result'),c.innerHTML=`<div class="search-stats">${a}</div>
        <hr>
        <ul class="search-result-list">${d.map(a=>a.item).join('')}</ul>`,typeof pjax=='object'&&pjax.refresh(c)}};a.highlightSearchWords(document.querySelector('.post-body')),NexT.CONFIG.localSearch.preload&&a.fetchData(),NexT.CONFIG.localSearch.trigger==='auto'?b.addEventListener('input',c):(document.querySelector('.search-icon').addEventListener('click',c),b.addEventListener('keypress',a=>{a.key==='Enter'&&c()})),window.addEventListener('search:loaded',c),document.querySelectorAll('.popup-trigger').forEach(c=>{c.addEventListener('click',()=>{document.body.classList.add('search-active'),setTimeout(()=>b.focus(),500),a.isfetched||a.fetchData()})});const d=()=>{document.body.classList.remove('search-active')};document.querySelector('.search-pop-overlay').addEventListener('click',a=>{a.target===document.querySelector('.search-pop-overlay')&&d()}),document.querySelector('.popup-btn-close').addEventListener('click',d),document.addEventListener('pjax:success',()=>{a.highlightSearchWords(document.querySelector('.post-body')),d()}),window.addEventListener('keyup',a=>{a.key==='Escape'&&d()})},NexT.plugins.others.translate=function(){const a='#gtranslate';if(!NexT.utils.checkDOMExist(a))return;NexT.utils.lazyLoadComponent(a,function(){window.translateelement_styles='/css/google-translate.min.css',NexT.utils.getScript('/js/third-party/google-translate.min.js')})}